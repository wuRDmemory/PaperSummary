# ORB-SLAM2的特征点提取方法



## 特点

ORBSLAM2可以说是最优秀的SLAM算法之一，该系统其实有很多细节地方做的很好，比如特征点的提取方法。如果使用常规的orb特征点提取法，那么很可能出现提取到的点比较密集的现象，其实相较而言，这个现象并不好，密集的点有时候会对三角化或者跟踪产生不好的影响，ORBSLAM2为了防止这种情况，使用四叉树分开所有的特征点，然后选择前N个（N是期望的提取数量）叶子节点的点作为关键点。



## 大致流程

1. 先对整个图像进行分块，提取FAST特征点；
2. 根据图像的长宽比，确定初始节点的数量，比如常用的640*480的图像，那么根节点的数量就是round(640/480)=1；
3. 把所有的特征点放入节点列表中；
4. 开始广度遍历节点列表中的节点（假设数量为n），对每个节点，将其分为4个子节点，并将自己包含的所有特征点分给四个子节点，并将他们放在节点列表中，并移除自身，这样此次遍历之后，节点列表中就只有子节点们了，数量假设为m个，这里$m\ne 4n$，因为数量为n的节点列表中的有些节点仅仅包含了1个特征点，这时候就不能再往下分了，导致数量没有增加；

现在我们回头看一下，我们目前有一些节点，这些节点有的可以继续分裂，有的则不能，如果再次分裂之后的节点数量大于等于期望值N了，那么显然程序此时就要退出了，但是对于那些特征点分布密集的区域来说，我们并没有对他们进行**特殊**的处理，所以为了**消灭**特征点分布密集的区域，这个时候应该额外的对再分裂的数量进行预测，如果预测的再分裂数量达到了预想的数量，那么我们就要对于内部特征点数量较多的区域进行先分裂，尽可能的保证最后的叶子节点中包含的特征点的数量是少的。

1. 如果进行到该步骤，就说明剩下的子节点们再分裂几次，叶子节点的数量就**可能**超过预期数量了，所以针对剩下的子节点们，算法先对每个子节点含有的特征点数量进行了从大到小的排序，目的是要先进行数量较多的节点的划分，尽可能的保证叶子节点中的特征点数是少的。
2. 然后就是一样的步骤，划分4个节点，在节点队列中去除自身节点，直到节点队列中的点节点数大于N；

上面的步骤属于一个大循环，结束了该循环，那么说明要么四叉树的叶子节点数已经到达期望数量N或者已经不能再进行分裂，此时遍历节点列表中的每一个节点，如果该节点只有一个关键点了，那么就把这个关键点放入到结果中；如果还有很多关键点，就从这些关键点中提取一个分数最高的作为关键点放入到结果中；

